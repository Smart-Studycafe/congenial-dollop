# Smart-Studycafe
IoT를 활용해 부정 사용자를 검출하고 사용자를 관리할 수 있는 서비스를 제공하는 스마트 스터디 카페 프로젝트입니다.   
## 기획
#### 메인 시나리오   
이용권을 구매하지 않고 사용하는 사용자를 감지하고 이를 이메일로 공지합니다.   
이미 이용권이 구매된 좌석에 대해선 감지하지 않습니다.   
1. 일정 시간마다 해당 좌석의 이용권 구매 여부 확인.
2. 구매하지 않았다면 esp32-cam을 이용한 객체 탐지(얼굴 인식) 실시.   
2-1. 최초 얼굴 인식 시 1분 간격으로 4회 추가 얼굴 인식.   
2-2. 3회 이상 인식된 경우 부정 사용자로 구분.   
2-3. 관리자에게 알림 이메일 전송.
   
#### 서브 시나리오 
사용자가 의도적으로 카메라를 막아 메인 시나리오가 진행되지 않는 경우 서브 시나리오로 진행됩니다.   
마찬가지로 이미 이용권이 구매된 좌석에 대해선 감지하지 않습니다.   
1. 밝기 감지를 통해 카메라가 가려졌는지 구분.
2. 카메라가 가려진 상태라면 일정 시간마다 해당 좌석의 이용권 구매 여부 확인.
3. 구매하지 않았다면 PIR 및 압력 센서를 통해 간접적으로 사용자를 인식.   
3-1. 최초 감지 시 1분 간격으로 4회 추가 감지.   
3-2. 3회 이상 감지된 경우 부정 사용자 의심.  
3-3. 관리자에게 알림 이메일 전송.

#### 핵심 기능
* 사용자, 관리자 모두 웹 사이트를 통해 이용 현황을 파악할 수 있습니다.
* 의심, 부정 사용자 검출시 관리자에게 알림 이메일을 전송합니다.
* 관리자는 웹 사이트에서 esp32-cam을 통해 부정 사용 또는 부정 사용으로 의심되는 사용자의 얼굴을 확인할 수 있고   
  이에 대해 경고음(부저)을 울릴 수 있습니다.

## 역할별 Task
#### Server
* 회원 등록(간단히)
  * user_id 등록.
* 입·퇴장 기능
  * 이용 좌석, 이용 시작 시간, 이용 종료 시간, 사용자 id 포함.
* 현재 사용 현황 반환 기능(전체, 개별)
  * 결제 현황(전체, 개별) 정보 포함.
* 관리자 페이지 경고 버튼 event 처리
  * 해당 좌석의 정보와 함께 지정된 topic으로 publish.

#### Front-end
관리자 페이지와 일반 사용자 페이지로 구분.   
관리자 페이지와 사용자 페이지는 url로 구분하며 로그인 기능은 별도로 구현하지 않음.   

공통
* 좌석 현황(예약 여부, 예약 시간, 유저 아이디 정보 포함) display
  
관리자 페이지
* 좌석을 눌렀을 때 실시간 비디오 형태 혹은 url에 접속하는 형태로 cam을 볼 수 있음
* 좌석에 대해 경고음을 울리도록하는 버튼 구현
  
일반 사용자 페이지
* 좌석을 눌렀을 때 이용권 구매화면 display

#### ESP32-cam
* cam을 사용하여 객체 탐지(얼굴 인식)하는 경우
  * 알고리즘에 따라 얼굴 인식 후 AWS IoT Core로 publish
* PIR, 압력 센서를 사용하여 사람 감지하는 경우
  * cam이 가려졌음을 인지하고 shadow로 부터 사람 감지 상태를 읽어 알고리즘 진행

#### ESP32(PIR, 압력 센서)
* 일정 주기마다 센서 값을 읽어 AWS IoT Core로 publish
  
#### AWS IoT Core
* 관리자로부터 요청이 오면 publish 하여 esp32의 울리는 역할
* publish 되는 PIR, 압력 센서의 값에 따라 shadow의 사람 감지 여부 상태를 update하는 Rule engine 생성
* ESP32에서 직접 shadow 값을 읽을 수 있는지 또는 IoT Core를 통해야하는지 조사 